(window.webpackJsonp=window.webpackJsonp||[]).push([["course"],{"07b4":function(t,e,i){"use strict";i("8e6e"),i("ac6a"),i("456d"),i("e7e5");var s=i("d399"),n=i("bd86"),r=i("3ce7"),a=i("2164"),o=i("2f62"),c=i("faa5");function l(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function u(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach((function(e){Object(n.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var d={name:"finish-dialog",mixins:[a.a],inject:["reload"],data:function(){return{show:!0,path:""}},props:{finishResult:{type:Object,default:function(){return{}}},courseId:{type:String,default:""}},computed:u(u({},Object(o.e)("course",{allTask:function(t){return t.allTask}})),{},{rate:function(){return this.finishResult?"".concat(parseInt(this.finishResult.completionRate),"%"):"0%"},title:function(){return this.finishResult?this.allTask[this.finishResult.result.courseTaskId].title:""}}),created:function(){this.path=this.$route.path},methods:u(u({},Object(o.d)("course",{setSourceType:c.x})),{},{goNextTask:function(){var t=this;if(!this.finishResult.nextTask)return Object(s.a)("没有下一课"),void(this.show=!1);var e={courseId:this.courseId,taskId:this.finishResult.nextTask.id};r.a.getCourseData({query:e}).then((function(e){t.toLearnTask(e)}))},toLearnTask:function(t){if("create"!==t.status){var e={id:t.id};this.$store.commit("course/".concat(c.h),{nextTask:e}),this.showTypeDetail(t),this.show=!1,this.setSourceType({sourceType:"img",taskId:t.id})}else Object(s.a)("课时创建中，敬请期待")},showTypeDetail:function(t){if("published"===t.status)switch(t.type){case"video":this.playVedio(t);break;case"audio":this.playAudio(t);break;case"text":case"ppt":case"doc":this.$router.push({name:"course_web",query:{courseId:this.courseId,taskId:t.id,type:t.type,backUrl:"/course/".concat(this.courseId)}}),this.reload();break;case"live":var e=new Date,i=new Date(1e3*t.endTime),n=(new Date(1e3*t.startTime),!1);if(e>i){if(t.activity&&"videoGenerated"===t.activity.replayStatus)return void("self"===t.mediaSource?this.setSourceType({sourceType:"video",taskId:t.id}):this.copyPcUrl(t.courseUrl));if(t.activity&&"ungenerated"===t.activity.replayStatus)return void Object(s.a)("暂无回放");n=!0}this.$router.push({name:"live",query:{courseId:this.courseId,taskId:t.id,type:t.type,title:t.title,replay:n}});break;case"testpaper":var r=t.activity.testpaperInfo.testpaperId;this.$router.push({name:"testpaperIntro",query:{testId:r,targetId:t.id}});break;case"homework":this.$router.push({name:"homeworkIntro",query:{courseId:this.courseId,taskId:t.id}});break;case"exercise":this.$router.push({name:"exerciseIntro",query:{courseId:this.courseId,taskId:t.id}});break;default:this.copyPcUrl(t.courseUrl)}else Object(s.a)("敬请期待")},playVedio:function(t){if("self"===t.mediaSource){var e="/course/".concat(this.courseId);this.$route.path===e?this.setSourceType({sourceType:"video",taskId:t.id}):this.$router.push({path:e,query:{sourceType:"video",taskId:t.id}})}else this.copyPcUrl(t.courseUrl)},playAudio:function(t){var e="/course/".concat(this.courseId);this.$route.path===e?this.setSourceType({sourceType:"audio",taskId:t.id}):this.$router.push({path:e,query:{sourceType:"audio",taskId:t.id}})},closeFinishDialog:function(){this.show=!1,this.$emit("closeFinishDialog")}})},h=i("a6c2"),p=Object(h.a)(d,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-overlay",{attrs:{show:t.show,"z-index":9999}},[i("div",{staticClass:"finish-dialog "},[i("div",{staticClass:"finish-dialog-content clearfix"},[i("div",{staticClass:"finish-dialog-top"},[i("img",{staticClass:"finish-dialog-img",attrs:{src:"static/images/reportDialog.png"}}),i("div",{staticClass:"finish-dialog-top--text"},[t._v("学习完成")])]),i("div",{staticClass:"finish-dialog-close",on:{click:t.closeFinishDialog}},[i("i",{staticClass:"iconfont icon-guanbi"})]),i("div",{staticClass:"progress-bar"},[i("div",{staticClass:"progress-bar__content"},[i("div",{staticClass:"progress-bar__rate",style:{width:t.rate}})]),i("div",{staticClass:"progress-bar__text"},[t._v(t._s(t.rate))])]),i("p",{staticClass:"finish-dialog-text"},[t._v("恭喜完成")]),[i("p",{staticClass:"text-overflow"},[t._v(t._s(t.title))]),i("div",{staticClass:"finish-dialog-btn",on:{click:t.goNextTask}},[t._v("下一课")])]],2)])])}),[],!1,null,null,null);e.a=p.exports},"202a":function(t,e,i){"use strict";i("8e6e"),i("ac6a"),i("456d"),i("e17f");var s=i("2241"),n=(i("e7e5"),i("d399")),r=(i("c5f6"),i("3b2b"),i("4917"),i("7f7f"),i("6762"),i("2fdb"),i("bd86")),a=i("32e6"),o=i.n(a),c=i("2f62"),l=i("3ce7"),u=i("fd23"),d=i("bced"),h=i("07b4"),p=i("4328"),f=i.n(p),m=i("c8a5");function v(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function y(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?v(Object(i),!0).forEach((function(e){Object(r.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):v(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var g={components:{countDown:u.a,tagLink:d.a,finishDialog:h.a},mixins:[m.a],props:{courseSet:{type:Object,default:function(){return{}}},seckillActivities:{type:Object,default:null}},data:function(){return{finishCondition:void 0,learnMode:!1,enableFinish:!1,isEncryptionPlus:!1,isCoverOpen:!1,isPlaying:!1,player:null,counting:!0,isEmpty:!1,textContent:null,tagData:{earnings:0,isShow:!1,link:"",className:"course-tag",minDirectRewardRatio:0},timeChangingList:[],bindAgencyRelation:{},finishResult:null,finishDialog:!1,lastWatchTime:0,nowWatchTime:0}},computed:y(y(y({},Object(c.e)(["DrpSwitch"])),Object(c.e)("course",{sourceType:function(t){return t.sourceType},selectedPlanId:function(t){return t.selectedPlanId},taskId:function(t){return t.taskId},details:function(t){return t.details},joinStatus:function(t){return t.joinStatus},user:function(t){var e;return(null===(e=t.joinStatus)||void 0===e?void 0:e.user)||{}},allTask:function(t){return t.allTask}})),{},{showLearnBtn:function(){return this.joinStatus&&["video","audio"].includes(this.sourceType)}}),watch:{taskId:function(t,e){("course"!==this.$route.name||this.joinStatus)&&t>0&&this.initHead()},selectedPlanId:function(t){("course"!==this.$route.name||this.joinStatus)&&t>0&&this.initHead()}},created:function(){this.initHead(),this.showTagLink()},beforeDestroy:function(){this.player&&this.player.destory&&this.player.destory(),this.clearComputeWatchTime()},methods:{toToast:function(){this.finishCondition&&this.$toast({message:this.finishCondition.text,position:"bottom"})},isAndroid:function(){return!!navigator.userAgent.match(new RegExp("android","i"))},initHead:function(){["video","audio"].includes(this.sourceType)&&(window.scrollTo(0,0),this.joinStatus&&(this.initReport(),this.clearComputeWatchTime(),this.lastWatchTime=0,this.nowWatchTime=0),this.initData())},initReport:function(){this.initReportData(this.selectedPlanId,this.taskId,this.sourceType),this.finishDialog=!1,this.getFinishCondition(),this.IsLivePlayback()},getFinishCondition:function(){var t=this;this.getCourseData(this.selectedPlanId,this.taskId).then((function(e){t.finishCondition=e.activity&&e.activity.finishCondition}))},IsLivePlayback:function(){"live"===this.allTask[this.taskId].type&&this.reprtData("finish")},viewAudioDoc:function(){this.isCoverOpen=!0},hideAudioDoc:function(){this.isCoverOpen=!1},handlePlayer:function(){return this.isPlaying?this.player&&this.player.pause():this.player&&this.player.play()},getParams:function(){return this.joinStatus?{query:{courseId:this.selectedPlanId,taskId:this.taskId},params:{version:"escloud"}}:{query:{courseId:this.selectedPlanId,taskId:this.taskId},params:{preview:1,version:"escloud"}}},initData:function(){this.$refs.video&&(this.$refs.video.innerHTML=""),this.enableFinish=!!parseInt(this.details.enableFinish),this.player&&this.player.destory&&this.player.destory(),this.getData()},getData:function(){var t=this;l.a.getMedia(this.getParams()).then((function(e){"audio"===e.mediaType?t.formateAudioData(e):"video"===e.mediaType&&t.formateVedioData(e)})).catch((function(e){var i=Number(t.details.id);4040101==e.code&&t.$router.push({name:"login",query:{redirect:"/course/".concat(i)}}),n.a.fail(e.message)}))},formateAudioData:function(t){var e=t.media;if(e.isFinishConvert)if(this.isEncryptionPlus=e.isEncryptionPlus,e.isEncryptionPlus)Object(n.a)("该浏览器不支持云视频播放，请下载App");else{this.textContent=e.text;var i={id:"course-detail__head--video",user:this.user,resNo:e.resNo,token:e.token,autoplay:!0,disableDataUpload:!0,watermark:{pos:"top.right",width:30,height:30}};this.$store.commit("UPDATE_LOADING_STATUS",!0),this.initPlayer(i)}else Object(n.a)("课程内容准备中，请稍候查看")},formateVedioData:function(t){var e=t.media,i=e.timeLimit,s=!this.joinStatus&&Number(this.details.tryLookable);if(e.isFinishConvert)if(this.isEncryptionPlus=e.isEncryptionPlus,e.isEncryptionPlus)Object(n.a)("该浏览器不支持云视频播放，请下载App");else{var r={id:"course-detail__head--video",user:this.user,autoplay:!0,disableFullscreen:"audio"===this.sourceType,strictMode:!e.supportMobile,pluck:{timelimit:i},resNo:e.resNo,disableDataUpload:!0,watermark:{pos:"top.right",width:30,height:30},token:e.token};s||delete r.pluck,this.$store.commit("UPDATE_LOADING_STATUS",!0),this.initPlayer(r)}else Object(n.a)("课程内容准备中，请稍候查看")},initPlayer:function(t){var e=this,i="//service-cdn.qiqiuyun.net/js-sdk-v2/sdk-v1.js?"+~~(Date.now()/1e3/60);o()(i,(function(i){if(e.$store.commit("UPDATE_LOADING_STATUS",!1),i)throw i;var n=new window.QiQiuYun.Player(t);e.player=n,n.on("unablePlay",(function(){e.$refs.video.innerHTML="",s.a.alert({message:"当前内容不支持该手机浏览器观看，建议您使用Chrome、Safari浏览器观看。"}).then((function(){}))})),n.on("ready",(function(){})),n.on("playing",(function(){e.isPlaying=!0,e.computeWatchTime()})),n.on("paused",(function(t){e.isPlaying=!1,e.clearComputeWatchTime();var i=parseInt(e.nowWatchTime-e.lastWatchTime);e.lastWatchTime=e.nowWatchTime,e.reprtData("doing",!0,i)})),n.on("ended",(function(){e.clearComputeWatchTime(),e.finishCondition&&"end"===e.finishCondition.type&&e.reprtData("finish")}))}))},expire:function(){this.counting=!1},sellOut:function(){this.isEmpty=!0,this.$emit("goodsEmpty")},showTagLink:function(){this.DrpSwitch?(this.initTagData(),this.getAgencyBindRelation()):this.tagData.isShow=!1},getAgencyBindRelation:function(){var t=this;l.a.getAgencyBindRelation().then((function(e){e.agencyId?(t.bindAgencyRelation=e,t.tagData.isShow=!0):t.tagData.isShow=!1}))},initTagData:function(){var t=this;l.a.getDrpSetting().then((function(e){t.drpSetting=e,t.tagData.minDirectRewardRatio=e.minDirectRewardRatio;var i={type:"course",id:t.details.id,merchant_id:t.drpSetting.merchantId};t.tagData.link=t.drpSetting.distributor_template_url+"?"+f.a.stringify(i);var s=t.drpSetting.minDirectRewardRatio/100*t.details.price;t.tagData.earnings=(Math.floor(100*s)/100).toFixed(2)}))},toLearned:function(){var t=this;this.reprtData("finish").then((function(e){t.finishResult=e,t.finishDialog=!0}))},computeWatchTime:function(){var t=this;this.intervalWatchTime=setInterval((function(){t.nowWatchTime++}),1e3)},clearComputeWatchTime:function(){clearInterval(this.intervalWatchTime)},closeFinishDialog:function(){this.finishDialog=!1}}},b=i("a6c2"),k=Object(b.a)(g,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"course-detail__head pos-rl",attrs:{id:"course-detail__head"}},[t.textContent?i("div",{directives:[{name:"show",rawName:"v-show",value:["audio"].includes(t.sourceType)&&!t.isEncryptionPlus&&!t.isCoverOpen,expression:"\n      ['audio'].includes(sourceType) && !isEncryptionPlus && !isCoverOpen\n    "}],staticClass:"course-detail__nav--btn",on:{click:t.viewAudioDoc}},[t._v("\n    文稿\n  ")]):t._e(),t.textContent?i("div",{directives:[{name:"show",rawName:"v-show",value:["audio"].includes(t.sourceType)&&!t.isEncryptionPlus,expression:"['audio'].includes(sourceType) && !isEncryptionPlus"}],staticClass:"course-detail__nav--cover web-view",class:{opened:t.isCoverOpen}},[i("div",{staticClass:"media-text",domProps:{innerHTML:t._s(t.textContent)}}),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isCoverOpen,expression:"isCoverOpen"}],staticClass:"course-detail__nav--cover-control",on:{click:t.handlePlayer}},[i("i",{staticClass:"iconfont",class:t.isPlaying?"icon-zanting":"icon-bofang"})]),i("div",{staticClass:"course-detail__nav--cover-close-btn",on:{click:t.hideAudioDoc}},[i("i",{staticClass:"van-icon van-icon-arrow van-nav-bar__arrow"})])]):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:"img"===t.sourceType||t.isEncryptionPlus||t.finishDialog,expression:"sourceType === 'img' || isEncryptionPlus || finishDialog"}],staticClass:"course-detail__head--img",attrs:{id:"course-detail__head--img"}},[t.courseSet.cover?i("img",{attrs:{src:t.courseSet.cover.large,alt:""}}):t._e(),t.seckillActivities&&"ongoing"===t.seckillActivities.status&&t.counting&&!t.isEmpty?i("countDown",{attrs:{activity:t.seckillActivities},on:{timesUp:t.expire,sellOut:t.sellOut}}):t._e()],1),i("div",{directives:[{name:"show",rawName:"v-show",value:["video","audio"].includes(t.sourceType)&&!t.isEncryptionPlus&&!t.finishDialog,expression:"\n      ['video', 'audio'].includes(sourceType) &&\n        !isEncryptionPlus &&\n        !finishDialog\n    "}],ref:"video",attrs:{id:"course-detail__head--video"}}),t.showLearnBtn?[t.isFinish?i("div",{staticClass:"course-detail__head--btn course-detail__head--activebtn"},[i("i",{staticClass:"iconfont icon-markdone"}),t._v("\n      学过了\n    ")]):t._e(),t.isFinish?t._e():i("div",[t.enableFinish?i("div",{staticClass:"course-detail__head--btn",on:{click:t.toLearned}},[t._v("\n        学过了\n      ")]):t._e(),t.enableFinish?t._e():i("div",{staticClass:"course-detail__head--btn",on:{click:t.toToast}},[t._v("\n        完成条件\n      ")])])]:t._e(),i("tagLink",{attrs:{"tag-data":t.tagData}}),t.finishDialog?i("finishDialog",{attrs:{finishResult:t.finishResult,courseId:t.selectedPlanId},on:{closeFinishDialog:t.closeFinishDialog}}):t._e()],2)}),[],!1,null,null,null);e.a=k.exports},2164:function(t,e,i){"use strict";i("e17f");var s=i("2241");e.a={methods:{copyPcUrl:function(t){var e=this,i="移动端暂不支持此类课程学习。请移步至电脑「".concat(t,"」完成课程。");s.a.alert({title:"暂不支持",message:i,messageAlign:"left",confirmButtonText:"复制链接"}).then((function(){e.$copyText(t).then((function(t){}))}))}}}},"32e6":function(t,e){function i(t,e){t.onload=function(){this.onerror=this.onload=null,e(null,t)},t.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),t)}}function s(t,e){t.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,e(null,t))}}t.exports=function(t,e,n){var r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("script");"function"==typeof e&&(n=e,e={}),e=e||{},n=n||function(){},a.type=e.type||"text/javascript",a.charset=e.charset||"utf8",a.async=!("async"in e)||!!e.async,a.src=t,e.attrs&&function(t,e){for(var i in e)t.setAttribute(i,e[i])}(a,e.attrs),e.text&&(a.text=""+e.text),("onload"in a?i:s)(a,n),a.onload||i(a,n),r.appendChild(a)}},4917:function(t,e,i){"use strict";var s=i("cb7c"),n=i("9def"),r=i("0390"),a=i("5f1b");i("214f")("match",1,(function(t,e,i,o){return[function(i){var s=t(this),n=void 0==i?void 0:i[e];return void 0!==n?n.call(i,s):new RegExp(i)[e](String(s))},function(t){var e=o(i,t,this);if(e.done)return e.value;var c=s(t),l=String(this);if(!c.global)return a(c,l);var u=c.unicode;c.lastIndex=0;for(var d,h=[],p=0;null!==(d=a(c,l));){var f=String(d[0]);h[p]=f,""===f&&(c.lastIndex=r(l,n(c.lastIndex),u)),p++}return 0===p?null:h}]}))},c8a5:function(t,e,i){"use strict";var s=i("3ce7"),n=i("faa5");e.a={data:function(){return{reportIntervalTime:null,reportLearnTime:null,reportFinishCondition:null,reportData:{courseId:null,taskId:null},reportResult:null,isFinish:!1,reportType:null,learnTime:0}},beforeDestroy:function(){this.clearReportIntervalTime()},methods:{initReportData:function(t,e,i){var s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.clearReportIntervalTime(),this.reportData={courseId:t,taskId:e},this.reportType=i,this.isFinish=!1,this.reportIntervalTime=null,this.reportLearnTime=null,this.reportResult=null,this.learnTime=0,this.reportFinishCondition=null,s&&this.initReportEvent()},initReportEvent:function(){this.reprtData(),this.intervalReportData(),this.intervalReportLearnTime()},getCourseData:function(t,e){var i=this,n={courseId:t,taskId:e};return new Promise((function(t,e){s.a.getCourseData({query:n}).then((function(e){i.reportFinishCondition=e.activity.finishCondition,t(e)})).catch((function(t){e(t)}))}))},reprtData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"doing",i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null!==this.reportData.courseId&&null!==this.reportData.taskId&&(!this.isFinish||i)){var r={};if("doing"===e){if(null!==this.reportResult){var a=this.reportResult.lastTime;r={lastTime:a}}n&&(r.watchTime=n)}var o={courseId:this.reportData.courseId,taskId:this.reportData.taskId,events:e};return new Promise((function(e,i){s.a.reportTask({query:o,data:r}).then((function(i){t.handleReprtResult(i),e(i)})).catch((function(t){i(t)}))}))}},handleReprtResult:function(t){this.reportResult=t,"finish"===t.result.status?(this.isFinish=!0,this.$store.commit(n.y,"finish"),this.$store.commit("course/".concat(n.C),t.completionRate)):this.$store.commit(n.y,"start")},intervalReportLearnTime:function(){var t=this;this.reportLearnTime=setInterval((function(){t.checkoutTime(),t.learnTime++}),1e3)},intervalReportData:function(){var t=this,e=60*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)*1e3;this.reportIntervalTime=setInterval((function(){t.reprtData("doing",!0)}),e)},checkoutTime:function(){this.reportFinishCondition&&"time"===this.reportFinishCondition.type&&parseInt(this.learnTime/60,10)>=parseInt(this.reportFinishCondition.data,10)&&this.reprtData("finish")},clearReportIntervalTime:function(){clearInterval(this.reportIntervalTime),clearInterval(this.reportLearnTime),this.reportIntervalTime=null,this.reportLearnTime=null}}}},fd4a:function(t,e,i){"use strict";i.r(e),i("8e6e"),i("ac6a"),i("456d"),i("e7e5");var s=i("d399"),n=(i("c5f6"),i("bd86")),r=(i("e17f"),i("2241")),a=(i("96cf"),i("3b8d")),o=i("b127"),c=i("202a"),l=i("410d"),u=i("2f62"),d=i("0d25"),h=i("3ce7");function p(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function f(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?p(Object(i),!0).forEach((function(e){Object(n.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var m={components:{service:l.a},data:function(){return{items:[],isFree:!1}},watch:{selectedPlanId:{immediate:!0,handler:function(t){var e=this;this.items=this.details.courses.map((function(t,i){return e.$set(t,"active",!1),t.id===e.details.id&&(t.active=!0),t}))}},learnExpiryHtml:{immediate:!0,handler:function(t){var e=this.details.learningExpiryDate,i=e.expiryStartDate.slice(0,10),s=e.expiryEndDate.slice(0,10);this.$emit("getLearnExpiry",{val:t,startDateStr:i,endDateStr:s})}}},computed:f(f(f({},Object(u.e)("course",{details:function(t){return t.details},selectedPlanId:function(t){return t.selectedPlanId},joinStatus:function(t){return t.joinStatus}})),Object(u.e)(["courseSettings","vipSwitch"])),{},{learnExpiryHtml:function(){var t=this.details.member,e=this.details.learningExpiryDate,i=e.expiryMode,s=e.expiryStartDate.slice(0,10),n=e.expiryEndDate.slice(0,10);if(t)return"forever"==i?"长期有效":0!=t.deadline?t.deadline.slice(0,10)+"之前可学习":"长期有效";switch(i){case"forever":return"长期有效";case"end_date":return n+"之前可学习";case"days":return e.expiryDays+"天内可学习";case"date":return'<div class = "mt5">开课日期：'+s+"&nbsp;&nbsp;&nbsp;截止日期："+n+"</div>"}return""},buyExpiryTime:function(){var t=new Date(this.details.buyExpiryTime);return Object(d.formatFullTime)(t)},showStudent:function(){return!this.courseSettings||Number(this.courseSettings.show_student_num_enabled)},defaultPlan:function(){return 1===this.items.length&&!this.items[0].title},isDiscount:function(){if(!this.details.courseSet)return!1;var t=this.details.courseSet.discount;if(""!==t){var e=Number(t);return 10!==e&&(0===e||e)}return""}}),methods:f(f({},Object(u.c)("course",["getCourseLessons"])),{},{handleClick:function(t,e){var i=this;h.a.meCourseMember({query:{id:t.id}}).then((function(e){e.id?i.$router.push({path:"/course/".concat(t.id)}):i.$router.push({path:"/goods/".concat(t.goodsId,"/show"),query:{targetId:t.id}})})).catch((function(){i.$router.push({path:"/goods/".concat(t.goodsId,"/show"),query:{targetId:t.id}})}))},filterPrice:function(){var t=this.details;return Number(t.isFree)||"0.00"===t.price?(this.isFree=!0,"免费"):(this.isFree=!1,"¥".concat(t.price))},toCertificate:function(t){this.$router.push({path:"/certificate/list/".concat(t)})}})},v=i("a6c2"),y=Object(v.a)(m,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("e-panel",{attrs:{title:t.details.courseSet.title,type:t.details.hasCertificate}},[i("div",{staticClass:"course-detail__plan-price"},[i("span",{class:{isFree:t.isFree}},[t._v(t._s(t.filterPrice())+"\n        "),t.isDiscount?i("span",{staticClass:"original-price ml10"},[t._v("原价：￥"+t._s(t.details.originPrice))]):t._e()]),t.showStudent?i("span",{staticClass:"plan-price__student-num"},[t._v(t._s(t.details.studentNum)+"人在学")]):t._e()])]),t.defaultPlan?t._e():i("ul",{staticClass:"course-detail__plan"},[t._l(t.items,(function(e,s){return[e.title?i("li",{key:s,class:{active:e.active},on:{click:function(i){return t.handleClick(e,s)}}},[t._v("\n        "+t._s(e.title)+"\n      ")]):t._e()]}))],2),i("div",{staticClass:"course-detail__validity"},[t.details.vipLevel&&t.vipSwitch?i("div",{staticClass:"mb15"},[i("span",{staticClass:"mr20"},[t._v("会员免费")]),i("img",{staticClass:"vipIcon",attrs:{src:t.details.vipLevel.icon}}),i("router-link",{staticClass:"color-primary",attrs:{to:{path:"/vip",query:{id:t.details.vipLevel.id}}}},[t._v("\n        "+t._s(t.details.vipLevel.name)+"免费学")])],1):t._e(),t.details.services.length?i("service",{attrs:{services:t.details.services}}):t._e(),i("div",[i("span",{staticClass:"mr20"},[t._v("学习有效期")]),i("span",{staticClass:"dark",domProps:{innerHTML:t._s(t.learnExpiryHtml)}})]),0!=t.details.buyExpiryTime?i("div",{staticClass:"mt5"},[i("span",{staticClass:"mr20"},[t._v("购买截止日期")]),i("span",{staticClass:"validity orange"},[t._v(t._s(t.buyExpiryTime))])]):t._e()],1),t.details.hasCertificate?i("div",{staticClass:"course-detail__certificate",on:{click:function(e){return t.toCertificate(t.selectedPlanId)}}},[t._m(0),i("i",{staticClass:"van-icon van-icon-arrow pull-right"})]):t._e()],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("span",[e("span",{staticClass:"certificate-icon"},[this._v("证")]),this._v("证书")])}],!1,null,null,null).exports,g={name:"Teacher",props:["teacherInfo"]},b=Object(v.a)(g,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("e-panel",{attrs:{title:"教师介绍"}},[t._l(t.teacherInfo,(function(e){return[i("div",{staticClass:"teacher-content"},[i("img",{staticClass:"avatar-img",attrs:{src:e.avatar.large}}),i("div",{staticClass:"teacher-cell"},[i("span",{staticClass:"dark font-family-PFM"},[t._v(t._s(e.nickname))]),i("span",{directives:[{name:"show",rawName:"v-show",value:e.title,expression:"item.title"}],staticClass:"text-content"},[t._v(t._s(e.title))])])])]}))],2)}),[],!1,null,null,null).exports,k=(i("6b54"),{name:"SwiperDirectory",props:{item:{type:Array,default:function(){return[]}},slideIndex:{type:Number,default:0},hasChapter:{type:Boolean,default:!0}},data:function(){return{current:this.slideIndex||0}},watch:{slideIndex:function(t,e){t!=e&&(this.current=t||0)}},methods:{changeChapter:function(t){this.current=t,this.$emit("changeChapter",t)},handleChapter:function(t){this.$refs.chapterSwipe.swipeTo(t)}}}),w=Object(v.a)(k,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"swiper-directory"},[i("van-swipe",{ref:"chapterSwipe",attrs:{"show-indicators":!1,loop:!1,touchable:!0,width:265,"initial-swipe":t.slideIndex},on:{change:t.changeChapter}},t._l(t.item,(function(e,s){return i("van-swipe-item",{key:s},[0==e.isExist?i("div",{staticClass:"chapter nochapter",class:"swiper-directory-active",on:{click:function(e){return t.handleChapter(s)}}},[i("i",{staticClass:"iconfont icon-wuzhangjieliang"}),t._v("\n        无章节\n      ")]):t._e(),1==e.isExist?i("div",{staticClass:"chapter haschapter",class:[t.current===s?"swiper-directory-active":""],on:{click:function(e){return t.handleChapter(s)}}},[i("p",{staticClass:"chapter-title text-overflow"},[t._v("\n          第"+t._s(e.number)+t._s(t.hasChapter?"章":"节")+"："+t._s(e.title)+"\n        ")]),i("p",{staticClass:"chapter-des text-overflow"},[t._v("\n          "+t._s(t.hasChapter?"节("+e.unitNum+")":"")+" 课时("+t._s(e.lessonNum)+") 学习任务("+t._s(e.tasksNum)+")\n        ")])]):t._e()])})),1)],1)}),[],!1,null,null,null).exports,C={name:"UtilDirectory",props:{util:{type:Object,default:function(){}}}},I=Object(v.a)(C,(function(){var t=this.$createElement,e=this._self._c||t;return 1==this.util.isExist?e("div",{staticClass:"util-directory text-overflow"},[this._v("\n  第"+this._s(this.util.number)+"节："+this._s(this.util.title)+"\n")]):this._e()}),[],!1,null,null,null).exports,O=i("d863"),_=i("2164"),T=i("faa5");function x(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function j(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?x(Object(i),!0).forEach((function(e){Object(n.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):x(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var D={name:"LessonDirectory",mixins:[O.a,_.a],props:{lesson:{type:Array,default:function(){return[]}},errorMsg:{type:String,default:""},taskId:{type:Number,default:-1},taskNumber:{type:Number,default:-1},unitNum:{type:Number,default:-1}},data:function(){return{currentTask:""}},watch:{taskId:{handler:"getTaskId",immediate:!0}},computed:j(j({},Object(u.e)("course",{details:function(t){return t.details},joinStatus:function(t){return t.joinStatus},selectedPlanId:function(t){return t.selectedPlanId}})),{},{hasLesson:function(){return this.lesson.length>0},isNoData:function(){return 0===this.taskNumber&&0===this.unitNum}}),mounted:function(){if(Object.keys(this.$route.query).length){var t=this.$route.query,e=t.sourceType,i=t.taskId;this.setSourceType({sourceType:e,taskId:i})}},methods:j(j({},Object(u.d)("course",{setSourceType:T.x})),{},{getTaskId:function(){this.currentTask=this.taskId},doubleLine:function(t){if(t.type)return"live"===t.type},showTask:function(t,e){var i=!0;return null==t.mode&&0==e&&(i=!1),"lesson"==t.mode&&(i=!1),i},lessonCellClick:function(t,e,i){if(this.$store.commit(T.y,""),this.errorMsg)this.$emit("showDialog");else if(t.lock)Object(s.a)("需要解锁上一个任务");else if("create"!==t.status&&"published"===t.status){var n={id:t.id};this.$store.commit("course/".concat(T.h),{nextTask:n}),!this.details.allowAnonymousPreview&&this.$router.push({name:"login",query:{redirect:this.redirect}}),this.joinStatus&&this.showTypeDetail(t)}else Object(s.a)("敬请期待")},showTypeDetail:function(t){if("published"===t.status)switch(t.type){case"video":"self"===t.mediaSource?this.setSourceType({sourceType:"video",taskId:t.id}):Object(s.a)("暂不支持此类型");break;case"audio":this.setSourceType({sourceType:"audio",taskId:t.id});break;case"text":case"ppt":case"doc":this.$router.push({name:"course_web",query:{courseId:this.selectedPlanId,taskId:t.id,type:t.type}});break;case"live":var e=new Date,i=new Date(1e3*t.endTime),n=(new Date(1e3*t.startTime),!1);if(e>i){if("videoGenerated"==t.activity.replayStatus)return void("self"===t.mediaSource?this.setSourceType({sourceType:"video",taskId:t.id}):Object(s.a)("暂不支持此类型"));if("ungenerated"==t.activity.replayStatus)return void Object(s.a)("暂无回放");n=!0}this.$router.push({name:"live",query:{courseId:this.selectedPlanId,taskId:t.id,type:t.type,title:t.title,replay:n}});break;case"testpaper":var r=t.activity.testpaperInfo.testpaperId;this.$router.push({name:"testpaperIntro",query:{testId:r,targetId:t.id}});break;case"homework":this.$router.push({name:"homeworkIntro",query:{courseId:this.$route.params.id,taskId:t.id}});break;case"exercise":this.$router.push({name:"exerciseIntro",query:{courseId:this.$route.params.id,taskId:t.id}});break;default:this.setSourceType({sourceType:"img",taskId:t.id}),this.copyPcUrl(t.courseUrl)}else Object(s.a)("敬请期待")},iconfont:function(t){switch(t.type){case"audio":return"icon-yinpin";case"doc":return"icon-wendang";case"exercise":return"icon-lianxi";case"flash":return"icon-flash";case"homework":return"icon-zuoye";case"live":return"icon-zhibo";case"ppt":return"icon-ppt";case"discuss":return"icon-taolun";case"testpaper":return"icon-kaoshi";case"text":return"icon-tuwen";case"video":return"icon-shipin";case"download":return"icon-xiazai";default:return""}},studyStatus:function(t){if(t.lock)return"icon-suo";if(null==t.result)return"icon-weixuexi";switch(t.result.status){case"finish":return"icon-yiwanchengliang";case"start":return"icon-weiwancheng";default:return""}},liveClass:function(t){if("published"!=t.status||"live"!=t.type)return"nopublished";var e=(new Date).getTime();return new Date(1e3*t.startTime),e>new Date(1e3*t.endTime)?"ungenerated"===t.activity.replayStatus?"end":"back":"play"}})};function S(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function P(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?S(Object(i),!0).forEach((function(e){Object(n.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):S(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var E={name:"AfterjoinDirectory",components:{swiperDirectory:w,utilDirectory:I,lessonDirectory:Object(v.a)(D,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t._l(t.lesson,(function(e,s){return t.hasLesson?i("div",{key:s,staticClass:"lesson-directory"},[i("div",{staticClass:"lesson-title",class:{"zb-ks":t.doubleLine(e.tasks[e.index])},attrs:{id:e.tasks[e.index].id},on:{click:function(i){return t.lessonCellClick(e.tasks[e.index],s,e.index)}}},[i("div",{staticClass:"lesson-title-r"},[i("div",{staticClass:"lesson-title-des"},[t.doubleLine(e.tasks[e.index])?t._e():i("div",{staticClass:"bl l22"},[i("span",{staticClass:"text-overflow ks",class:{lessonactive:t.currentTask==e.tasks[e.index].id}},[i("i",{staticClass:"iconfont",class:t.iconfont(e.tasks[e.index])}),t._v("\n              "+t._s(Number(e.tasks[e.index].isOptional)?"选修 ":"课时")+t._s(Number(e.tasks[e.index].isOptional)?" ":e.tasks[e.index].number+":"+e.title)+"\n            ")])]),t.doubleLine(e.tasks[e.index])?i("div",{staticClass:"bl"},[i("div",{staticClass:"block-inline"},[i("span",{staticClass:"bl text-overflow ks",class:{lessonactive:t.currentTask==e.tasks[e.index].id}},[i("i",{staticClass:"iconfont",class:t.iconfont(e.tasks[e.index])}),t._v("\n                "+t._s(Number(e.tasks[e.index].isOptional)?"选修 ":"课时")+t._s(Number(e.tasks[e.index].isOptional)?" ":e.tasks[e.index].number+":"+e.title)+"\n              ")]),i("span",{staticClass:"bl zbtime"},[i("span",{class:[t.liveClass(e.tasks[e.index])]},[t._v(t._s(t._f("filterTaskTime")(e.tasks[e.index])))])])])]):t._e()])]),i("div",{staticClass:"lesson-title-l"},["live"!=e.tasks[e.index].type?i("span",[t._v(t._s(t._f("filterTaskTime")(e.tasks[e.index])))]):t._e(),i("i",{staticClass:"iconfont",class:t.studyStatus(e.tasks[e.index])})])]),e.tasks.length>1?i("div",{staticClass:"lesson-items"},t._l(e.tasks,(function(e,n){return t.showTask(e,n)?i("div",{key:n,staticClass:"litem",attrs:{id:e.id},on:{click:function(i){return t.lessonCellClick(e,s,n)}}},[i("div",{staticClass:"litem-r text-overflow",class:{lessonactive:t.currentTask==Number(e.id)}},[i("i",{staticClass:"iconfont",class:t.iconfont(e)}),t._v("\n          "+t._s(Number(e.isOptional)?"选修 ":"课时")+t._s(Number(e.isOptional)?" ":e.number+":"+e.title)+"\n        ")]),i("div",{staticClass:"litem-l clearfix"},[i("span",{class:[t.liveClass(e),"text-overflow"]},[t._v(t._s(t._f("filterTaskTime")(e)))]),i("i",{staticClass:"iconfont",class:t.studyStatus(e)})])]):t._e()})),0):t._e()]):t._e()})),t.isNoData?i("div",{staticClass:"noneItem"},[i("img",{staticClass:"notask",attrs:{src:"static/images/none.png"}}),i("p",[t._v("暂时还没有课时哦...")])]):t._e()],2)}),[],!1,null,null,null).exports},data:function(){return{scroll:"",item:[],level:3,chapterNum:0,unitNum:0,lessonNum:0,currentChapter:0,currentUnit:0,currentLesson:0,slideIndex:0,taskId:null,nodata:!1,allTask:{},allTaskId:[]}},computed:P(P({},Object(u.e)("course",{nextStudy:function(t){return t.nextStudy},selectedPlanId:function(t){return t.selectedPlanId},OptimizationCourseLessons:function(t){return t.OptimizationCourseLessons},details:function(t){return t.details},taskStatus:function(t){return t.taskStatus}})),{},{hasChapter:function(){return this.chapterNum>0}}),watch:{nextStudy:{handler:"getNextStudy",immediate:!0},selectedPlanId:{handler:"processItem",immediate:!0,deep:!0},taskStatus:{handler:"changeTaskStatus",immediate:!1}},methods:{getNextStudy:function(){if(this.nextStudy.nextTask){this.taskId=Number(this.nextStudy.nextTask.id);var t=this.allTask[this.taskId];if(!t)return;this.hasChapter?this.slideIndex=t.chapterIndex:this.slideIndex=t.unitIndex}},processItem:function(t){var e=this.OptimizationCourseLessons;this.resetData(),e.length?(this.nodata=!1,this.setItems(e),this.mapChild(this.item),this.startScroll(),this.$store.commit("course/".concat(T.l),this.allTask)):this.nodata=!0},resetData:function(){this.chapterNum=0,this.unitNum=0,this.lessonNum=0},setItems:function(t){this.level=1===t.length&&0==t[0].isExist?2:3,1===t.length?this.item=2===this.level?t[0].children:t:t.length>1&&(this.item=t)},mapChild:function(t){var e=this;t.map((function(i,s){"chapter"===i.type?e.formatChapter(i,t,s):"unit"===i.type?e.formatUnit(i,t,s):"lesson"===i.type?e.formatLesson(i,t,s):e.formatTask(i,t,s)}))},startScroll:function(){var t=this;this.$nextTick((function(){if(t.taskId){var e=document.getElementById("progress-bar"),i=document.getElementById("swiper-directory"),s=document.getElementById(t.taskId),n=e?e.offsetHeight:0,r=i?i.offsetHeight:0,a=(s?s.offsetTop:0)-n-44-r;a<document.documentElement.clientWidth||window.scrollTo({top:a})}}))},formatChapter:function(t,e,i){this.currentChapter=i,t.chapterNum=0,t.unitNum=0,t.lessonNum=0,t.tasksNum=0,t.isExist&&(this.chapterNum+=1,this.computedNum(1,"chapterNum")),Array.isArray(t.children)&&t.children.length>0&&this.mapChild(t.children)},formatUnit:function(t,e,i){this.currentUnit=i,t.unitNum=0,t.lessonNum=0,t.tasksNum=0,t.isExist&&(this.unitNum+=1,this.computedNum(1,"unitNum")),Array.isArray(t.children)&&t.children.length>0&&(this.computedNum(t.children.length,"lessonNum"),this.mapChild(t.children))},formatLesson:function(t,e,i){this.currentLesson=i,t.isExist&&(this.lessonNum+=1),t.tasks&&(this.computedNum(t.tasks.length-1,"tasksNum"),this.mapChild(t.tasks))},formatTask:function(t,e,i){Number(t.id)===this.taskId&&(this.slideIndex=3==this.level?this.currentChapter:this.currentUnit),this.getLessonIndex(t,i),t.chapterIndex=this.currentChapter,t.unitIndex=this.currentUnit,t.LessonIndex=this.currentLesson,t.level=this.level,t.taskIndex=i,this.allTask[t.id]=P({},t),this.allTaskId.push(t.id)},getLessonIndex:function(t,e){t.mode?"lesson"===t.mode&&this.getMainTask(t,e):this.getMainTask(t,0)},getMainTask:function(t,e){3===this.level?this.$set(this.item[this.currentChapter].children[this.currentUnit].children[this.currentLesson],"index",e):this.$set(this.item[this.currentUnit].children[this.currentLesson],"index",e)},computedNum:function(t,e){var i=3===this.level?this.currentChapter:this.currentUnit,s=this.item[i][e]+t;this.$set(this.item[i],e,s)},changeChapter:function(t){this.slideIndex=t},changeTaskStatus:function(t){if(t){"finish"===t&&this.changeLockStatus();var e=this.allTask[this.taskId],i={};if(2===e.level){var s=this.item[e.unitIndex].children[e.LessonIndex].tasks[e.taskIndex];s.result?s.result.status=t:(i.status=t,s.result=i)}else{var n=this.item[e.chapterIndex].children[e.unitIndex].children[e.LessonIndex].tasks[e.taskIndex];n.result?n.result.status=t:(i.status=t,n.result=i)}}},changeLockStatus:function(){if("lockMode"===this.details.learnMode){var t=this.allTaskId.indexOf(this.taskId.toString());if(t<this.allTaskId.length-1){var e=this.allTaskId[t+1],i=this.allTask[e];2===i.level?this.item[i.unitIndex].children[i.LessonIndex].tasks[i.taskIndex].lock=!1:this.item[i.chapterIndex].children[i.unitIndex].children[i.LessonIndex].tasks[i.taskIndex].lock=!1}}}}},N=Object(v.a)(E,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"afterjoin-directory"},[t.lessonNum>0?i("div",[t.chapterNum>0||t.unitNum>0?i("swiper-directory",{attrs:{id:"swiper-directory",item:t.item,"slide-index":t.slideIndex,"has-chapter":t.hasChapter},on:{changeChapter:t.changeChapter}}):t._e(),t.item.length>0?i("div",{attrs:{id:"lesson-directory"}},[t.chapterNum>0?t._l(t.item[t.slideIndex].children,(function(e,s){return i("div",{key:s,staticClass:"pd-bo"},[i("util-directory",{attrs:{util:e}}),i("lesson-directory",t._g(t._b({attrs:{lesson:e.children,"task-id":t.taskId,"task-number":t.item[t.slideIndex].lessonNum,"unit-num":t.item[t.slideIndex].unitNum}},"lesson-directory",t.$attrs,!1),t.$listeners))],1)})):i("div",{staticClass:"pd-bo"},[i("lesson-directory",t._g(t._b({attrs:{lesson:t.item[t.slideIndex].children,"task-id":t.taskId,"task-number":t.item[t.slideIndex].lessonNum,"unit-num":t.item[t.slideIndex].unitNum}},"lesson-directory",t.$attrs,!1),t.$listeners))],1)],2):t._e()],1):t._e(),t.nodata&&0==t.lessonNum?i("div",{staticClass:"noneItem"},[i("img",{staticClass:"nodata",attrs:{src:"static/images/none.png"}}),i("p",[t._v("暂时还没有课程哦...")])]):t._e()])}),[],!1,null,null,null).exports,L=i("326d"),$=i("2095"),F=i("4928");function A(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function R(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?A(Object(i),!0).forEach((function(e){Object(n.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):A(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var q={inheritAttrs:!0,props:{details:{type:Object,value:function(){}}},data:function(){return{headBottom:0,active:1,scrollFlag:!1,tabs:["课程介绍","课程目录"],tabFixed:!1,errorMsg:"",offsetTop:"",offsetHeight:"",isFixed:!1,courseSettings:{},isShowForm:!1,paramsList:{action:"buy_after",targetType:"course",targetId:this.details.id}}},mixins:[$.a],computed:R(R(R({},Object(u.e)("course",{selectedPlanId:function(t){return t.selectedPlanId},currentJoin:function(t){return t.currentJoin}})),Object(u.e)(["user"])),{},{progress:function(){return Number(this.details.publishedTaskNum)?parseInt(this.details.progress.percent)+"%":"0%"},summary:function(){return this.details.summary||this.details.courseSet.summary},isClassCourse:function(){return Number(this.details.parentId)}}),watch:{selectedPlanId:function(t,e){this.active=1},currentJoin:{handler:function(t,e){var i=this;t&&(s.a.loading({duration:0,message:"加载中...",forbidClick:!0}),this.getInfoCollectionEvent(this.paramsList).then((function(t){if(Object.keys(t).length)return i.userInfoCollect=t,void i.getInfoCollectionForm(t.id).then((function(t){i.isShowForm=!0,s.a.clear()}));s.a.clear()})))},immediate:!0},$route:function(t,e){this.resetFrom()}},mounted:function(){window.addEventListener("scroll",this.handleScroll),this.$nextTick((function(){var t=document.getElementById("course-detail__head").offsetHeight;this.offsetTop=t+46,this.offsetHeight=44}))},created:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.showDialog(),e.next=3,h.a.getSettings({query:{type:"course"}}).catch((function(t){}));case 3:t.courseSettings=e.sent;case 4:case"end":return e.stop()}}),e)})))()},components:{Directory:o.a,DetailHead:c.a,DetailPlan:y,Teacher:b,afterjoinDirectory:N,infoCollection:F.a,Reviews:L.a},destroyed:function(){window.removeEventListener("scroll",this.handleScroll)},methods:R(R({},Object(u.d)("course",{setCurrentJoin:T.q})),{},{gotoGoodsPage:function(){this.$router.push({path:"/goods/".concat(this.details.goodsId,"/show"),query:{targetId:this.details.id}})},showDialog:function(){var t=this;if(this.details.member){var e="";if(this.details.member.access&&(e=this.details.member.access.code),e&&"success"!==e){this.errorMsg=this.getErrorMsg(e);var i="",n=function(){};if("course.expired"===e||"member.expired"===e&&!this.isClassCourse){i="课程已到期，无法继续学习，是否退出";var r={id:this.details.id};n=function(){h.a.deleteCourse({query:r}).then((function(t){t.success?window.location.reload():s.a.fail("退出课程失败，请稍后重试")}))},this.callConfirm(i,n)}else"vip.member_expired"===e?(i="会员已到期，请及时续费会员",n=function(){t.$router.push({path:"/vip"})},this.callConfirm(i,n)):s.a.fail(this.errorMsg)}}},getErrorMsg:function(t){switch(t){case"course.not_found":return"当前课程不存在";case"course.unpublished":return"当前课程未发布";case"course.expired":return"当前课程已过期";case"course.not_arrive":return"当前课程还不能学习";case"user.not_login":return"用户未登录";case"user.locked":return"用户被锁定";case"member.not_found":return"用户未加入课程";case"member.expired":return"课程已过期";case"vip.vip_closed":return"网校已关闭会员功能";case"vip.not_login":return"用户未登录";case"vip.not_member":return"当前用户并不是vip";case"vip.member_expired":return"用户会员服务已过期";case"vip.level_not_exist":return"用户会员等级或课程会员不存在";case"vip.level_low":return"用户会员等级过低";default:return"异常错误"}},callConfirm:function(t,e){r.a.confirm({message:t,title:""}).then((function(){e()})).catch((function(){}))},handleScroll:function(){var t=document.getElementById("swiper-directory"),e=document.documentElement.scrollHeight,i=document.documentElement.clientHeight;(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)>this.offsetTop&&e-this.offsetTop>i?(this.tabFixed=!0,t&&t.classList.add("swiper-directory-fix")):(this.tabFixed=!1,t&&t.classList.remove("swiper-directory-fix"))},onCancelForm:function(){this.setCurrentJoin(!1),this.isShowForm=!1}})},M=Object(v.a)(q,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"join-after"},[i("detail-head",{attrs:{"course-set":t.details.courseSet}}),i("van-tabs",{ref:"tabs",class:t.tabFixed?"isFixed":"",attrs:{id:"tabs"},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.tabs,(function(t){return i("van-tab",{key:t,attrs:{title:t}})})),1),i("div",{staticClass:"join-after__content"},[i("div",{directives:[{name:"show",rawName:"v-show",value:1==t.active,expression:"active == 1"}]},[i("div",{class:["progress-bar",t.tabFixed?"progress-bar-fix":""],attrs:{id:"progress-bar"}},[i("div",{staticClass:"progress-bar__content"},[i("div",{staticClass:"progress-bar__rate",style:{width:t.progress}})]),i("div",{staticClass:"progress-bar__text"},[t._v(t._s(t.progress))])]),i("afterjoin-directory",{attrs:{"error-msg":t.errorMsg},on:{showDialog:t.showDialog}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:0==t.active,expression:"active == 0"}]},[i("detail-plan",{on:{switchPlan:t.showDialog}}),i("div",{staticClass:"segmentation"}),i("e-panel",{attrs:{title:"课程介绍"}},[i("div",{domProps:{innerHTML:t._s(t.summary)}})]),i("div",{staticClass:"segmentation"}),i("teacher",{staticClass:"teacher",attrs:{"teacher-info":t.details.teachers}}),i("div",{staticClass:"segmentation"}),i("reviews",{attrs:{details:t.details}}),i("div",{staticClass:"segmentation"}),i("div",{staticClass:"segmentation"}),i("div",{staticClass:"segmentation"})],1)]),i("van-action-sheet",{staticClass:"minHeight50",attrs:{title:t.userInfoCollectForm.formTitle,"close-on-click-overlay":!1,"safe-area-inset-bottom":!0},on:{cancel:t.onCancelForm},model:{value:t.isShowForm,callback:function(e){t.isShowForm=e},expression:"isShowForm"}},[i("info-collection",{attrs:{userInfoCollectForm:t.userInfoCollectForm,formRule:t.userInfoCollectForm.items},on:{submitForm:t.onCancelForm}})],1),0==t.active&&this.details.goodsId?i("e-footer",{nativeOn:{click:function(e){return t.gotoGoodsPage(e)}}},[t._v("\n    去商品页\n  ")]):t._e()],1)}),[],!1,null,null,null).exports,U=i("86ee"),H=i("d0b2"),J=i("49a2"),W=i("8b9d"),B=i("a262");function z(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function G(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?z(Object(i),!0).forEach((function(e){Object(n.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):z(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var V={name:"JoinBefore",components:{Teacher:b,Directory:o.a,DetailHead:c.a,DetailPlan:y,moreMask:U.a,reviewList:H.a,onsale:J.a,infoCollection:F.a},mixins:[O.a,W.a,B.a,$.a],data:function(){return{tabs:["课程介绍","课程目录","学员评价"],loadMoreAbout:!1,active:0,tabsClass:"",learnExpiry:"长期有效",startDateStr:"",endDateStr:"",tops:{aboutTop:0,courseTop:0,reviewTop:0},isEmpty:!0,unreceivedCoupons:[],miniCoupons:[],marketingActivities:{seckill:{}},courseSettings:{},isShowForm:!1,paramsList:{}}},watch:{$route:function(t,e){this.resetFrom()}},created:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.getSettings({query:{type:"course"}}).catch((function(t){}));case 2:t.courseSettings=e.sent;case 3:case"end":return e.stop()}}),e)})))()},computed:G(G(G({},Object(u.e)(["couponSwitch","user"])),Object(u.e)("course",{details:function(t){return t.details}})),{},{summary:function(){return this.details.summary||this.details.courseSet.summary},isClassCourse:function(){return Number(this.details.parentId)},accessToJoin:function(){return"success"===this.details.access.code||"user.not_login"===this.details.access.code},vipAccessToJoin:function(){var t=!1;return!(!this.details.vipLevel||!this.user.vip)&&(this.details.vipLevel.seq<=this.user.vip.seq&&(t=!(new Date(this.user.vip.deadline).getTime()<(new Date).getTime())),t)},showOnsale:function(){return!this.isClassCourse&&0!==Number(this.details.price)&&!!(this.unreceivedCoupons.length||Object.keys(this.marketingActivities).length&&!this.onlySeckill)},onlySeckill:function(){return 1===Object.keys(this.marketingActivities).length&&this.marketingActivities.seckill},seckillStatus:function(){var t=this.marketingActivities.seckill;return Object(d.dateTimeDown)(new Date(t.endTime).getTime())},showSeckill:function(){var t=this.marketingActivities.seckill;return!this.isClassCourse&&0!==Number(this.details.price)&&t&&"ongoing"==t.status&&!this.isEmpty}}),mounted:function(){var t=this;!this.isClassCourse&&this.couponSwitch&&(h.a.searchCoupon({params:{targetId:this.details.courseSet.id,targetType:"course"}}).then((function(e){t.unreceivedCoupons=e.data,t.miniCoupons=t.unreceivedCoupons.length>3?t.unreceivedCoupons.slice(0,4):t.unreceivedCoupons})).catch((function(t){})),h.a.coursesActivities({query:{id:this.details.id}}).then((function(e){t.marketingActivities=e,t.isEmpty=!e.seckill||!+e.seckill.productRemaind})).catch((function(t){}))),window.addEventListener("touchmove",this.handleScroll),window.addEventListener("scroll",this.handleScroll),setTimeout((function(){window.scrollTo(0,0)}),100)},destroyed:function(){window.removeEventListener("touchmove",this.handleScroll),window.removeEventListener("scroll",this.handleScroll)},methods:G(G({},Object(u.c)("course",["joinCourse","getAfterCourse"])),{},{onTabClick:function(t,e){var i=this.$refs[this.transIndex2Tab(t)];window.scrollTo(0,i.$el.offsetTop-44)},transIndex2Tab:function(t){return["about","directory","review"][t]},handleScroll:function(){var t=this;if(!this.scrollFlag){this.scrollFlag=!0;var e=this.$refs,i=["about","directory","review"].reverse();setTimeout((function(){Object.keys(e).forEach((function(i){e[i]&&(t.tops["".concat(i,"Top")]=e[i].$el.getBoundingClientRect().top)})),t.scrollFlag=!1,t.tabsClass=t.tops.aboutTop-44<=0?"van-tabs--fixed":"";for(var s=0;s<i.length;s++)if(t.tops["".concat(i[s],"Top")]-44<=0)return void(t.active=i.length-s-1)}),400)}},activeCurrentTab:function(t){var e=this.tops;return(t+=44)<e.teacherTop?0:t>=e.directoryTop?2:1},handleJoin:function(){var t=this.vipAccessToJoin;if(this.accessToJoin||t)if(this.$store.state.token){var e=this.details.learningExpiryDate.expiryEndDate,i=new Date(e).getTime(),s=(new Date).getTime(),n=s<i;if(n=0==e||s<i,Number(this.details.buyable)&&n||t){if(+this.details.price&&!t)return void this.getOrder();this.collectUseInfoEvent()}}else this.$router.push({name:"login",query:{redirect:this.redirect}});else this.$toast("禁止加入")},joinFreeCourse:function(){var t=this;this.joinCourse({id:this.details.id}).then((function(e){s.a.clear(),0!==Object.keys(e).length||t.getOrder()})).catch((function(t){}))},getAfCourse:function(t){this.getAfterCourse({courseId:t}).then((function(){})).catch((function(t){s.a.fail(t.message)}))},getLearnExpiry:function(t){this.learnExpiry=t.val,this.startDateStr=t.startDateStr,this.endDateStr=t.endDateStr},switchPlan:function(){var t=this;this.marketingActivities={},h.a.coursesActivities({query:{id:this.details.id}}).then((function(e){t.marketingActivities=e})).catch((function(t){}))},getOrder:function(){var t=this.details.learningExpiryDate.expiryMode,e="".concat(this.startDateStr," 至 ").concat(this.endDateStr),i="date"===t?e:this.learnExpiry;this.$router.push({name:"order",params:{id:this.details.id},query:{expiryScope:i,targetType:"course"}})},sellOut:function(){this.isEmpty=!0},getParamsList:function(){this.paramsList={action:"buy_before",targetType:"course",targetId:this.details.id}},collectUseInfoEvent:function(){var t=this;this.hasUserInfoCollectForm?this.isShowForm=!0:(s.a.loading({duration:0,message:"加载中...",forbidClick:!0}),this.getParamsList(),this.getInfoCollectionEvent(this.paramsList).then((function(e){if(Object.keys(e).length)return t.userInfoCollect=e,void t.getInfoCollectionForm(e.id).then((function(e){t.isShowForm=!0,s.a.clear()}));t.joinFreeCourse()})))}})},Q=Object(v.a)(V,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:t.isClassCourse?"":"join-before"},[i("detail-head",{attrs:{price:t.details.price,"course-set":t.details.courseSet,"seckill-activities":t.marketingActivities.seckill},on:{goodsEmpty:t.sellOut}}),i("detail-plan",{on:{getLearnExpiry:t.getLearnExpiry,switchPlan:t.switchPlan}}),i("div",{staticClass:"segmentation"}),t.showOnsale?[i("onsale",{attrs:{"unreceived-coupons":t.unreceivedCoupons,"mini-coupons":t.miniCoupons,activities:t.marketingActivities}}),i("div",{staticClass:"segmentation"})]:t._e(),i("van-tabs",{class:t.tabsClass,on:{click:t.onTabClick},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.tabs,(function(t){return i("van-tab",{key:t,attrs:{title:t}})})),1),i("e-panel",{ref:"about",staticClass:"about",attrs:{title:"课程介绍"}},[i("more-mask",{attrs:{disabled:t.loadMoreAbout},on:{maskLoadMore:function(e){t.loadMoreAbout=!0}}},[i("div",{domProps:{innerHTML:t._s(t.summary)}})])],1),i("div",{staticClass:"segmentation"}),i("teacher",{staticClass:"teacher",attrs:{"teacher-info":t.details.teachers,title:"教师介绍"}}),i("div",{staticClass:"segmentation"}),i("directory",{ref:"directory"}),i("div",{staticClass:"segmentation"}),i("review-list",{ref:"review",attrs:{"target-id":t.details.courseSet.id,reviews:1==t.courseSettings.show_review?t.details.reviews:[],title:"学员评价",type:"course","defaul-value":"暂无评价"}}),i("van-action-sheet",{staticClass:"minHeight50",attrs:{title:t.userInfoCollectForm.formTitle,"close-on-click-overlay":!1,"safe-area-inset-bottom":!0},model:{value:t.isShowForm,callback:function(e){t.isShowForm=e},expression:"isShowForm"}},[i("info-collection",{attrs:{userInfoCollectForm:t.userInfoCollectForm,formRule:t.userInfoCollectForm.items},on:{submitForm:t.joinFreeCourse}})],1),t.isClassCourse||t.marketingActivities.seckill&&(!t.marketingActivities.seckill||!t.isEmpty&&"已到期"!==t.seckillStatus)&&0!=t.details.price?t._e():i("e-footer",{attrs:{disabled:!t.accessToJoin},nativeOn:{click:function(e){return t.handleJoin(e)}}},[t._v("\n    "+t._s(t._f("filterJoinStatus")(t.details.access.code,"course",t.vipAccessToJoin)))]),t.showSeckill&&"已到期"!==t.seckillStatus?i("div",[i("e-footer",{attrs:{disabled:!t.accessToJoin,half:"true"},nativeOn:{click:function(e){return t.handleJoin(e)}}},[t._v(t._s(t._f("filterJoinStatus")(t.details.access.code,"course",t.vipAccessToJoin)))]),i("e-footer",{attrs:{half:"true"},nativeOn:{click:function(e){return t.activityHandle(t.marketingActivities.seckill.id)}}},[t._v("去秒杀")])],1):t._e()],2)}),[],!1,null,null,null).exports;function Y(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function K(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Y(Object(i),!0).forEach((function(e){Object(n.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Y(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var X={components:{},inject:["reload"],data:function(){return{currentComp:""}},computed:K(K({},Object(u.e)("course",{selectedPlanIndex:function(t){return t.selectedPlanIndex},joinStatus:function(t){return t.joinStatus},details:function(t){return t.details},selectedPlanId:function(t){return t.selectedPlanId}})),Object(u.e)({isLoading:function(t){return t.isLoading}})),watch:{joinStatus:{handler:"joinStatusChange"},$route:function(t,e){this.getData()}},created:function(){this.getData()},methods:K(K(K({},Object(u.c)("course",["getCourseLessons"])),Object(u.d)("course",{setSourceType:T.x})),{},{getData:function(){var t=this;this.getCourseLessons({courseId:this.$route.params.id}).then((function(e){e.member||Number(t.details.parentId)?t.joinStatusChange(e.member):t.$router.push({path:"/goods/".concat(e.goodsId,"/show")})}))},joinStatusChange:function(t){this.currentComp="",this.currentComp=t?M:Q},getJoinAfter:function(){this.getJoinAfterDetail({courseId:this.$route.params.id}).then((function(t){})).catch((function(t){s.a.fail(t.message)}))}}),beforeRouteLeave:function(t,e,i){this.setSourceType({sourceType:"img",taskId:0}),i()}},Z=Object(v.a)(X,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"course-detail"},[this.isLoading?e("e-loading"):this._e(),e(this.currentComp,{tag:"component",attrs:{details:this.details}})],1)}),[],!1,null,null,null);e.default=Z.exports}}]);