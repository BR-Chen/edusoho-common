(window.webpackJsonp=window.webpackJsonp||[]).push([["fastlogin"],{"1495a":function(e,t,n){"use strict";n.r(t),n("8e6e"),n("ac6a"),n("456d");var i=n("bd86"),a=(n("e7e5"),n("d399")),r=(n("96cf"),n("3b8d")),s=n("f13d"),o=n("3ce7"),c=n("a262"),u=n("d863"),l=n("7185"),d={data:function(){return{count:{showCount:!1,num:60,codeBtnDisable:!1}}},methods:{validateMobileOrPsw:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"mobile",t=this.userinfo[e],n=l.a[e];0===t.length&&(this.errorMessage[e]=""),this.errorMessage[e]=n.validator(t)?"":n.message},validatedChecker:function(){this.userinfo.mobile.length>11&&(this.userinfo.mobile=this.userinfo.mobile.substring(0,11));var e=this.userinfo.mobile,t=l.a.mobile;this.validated.mobile=t.validator(e)},countDown:function(){var e=this;this.$nextTick((function(){e.$refs.smsCode.$refs.input.focus()})),this.count.showCount=!0,this.count.codeBtnDisable=!0,this.count.num=60;var t=setInterval((function(){if(e.count.num<=0)return e.count.codeBtnDisable=!1,e.count.showCount=!1,void clearInterval(t);e.count.num-=1}),1e3)},handleSubmit:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.btnDisable||this.fastLogin({mobile:this.userinfo.mobile,smsToken:this.userinfo.smsToken,smsCode:this.userinfo.smsCode,loginType:"sms",client:"h5"}).then((function(t){return e(t)})).catch((function(e){t&&t(e.message),a.a.fail(e.message)}))},handleSendSms:function(){var e=this;if(""===this.userinfo.dragCaptchaToken)return this.$refs.dragComponent.initDragCaptcha(),void a.a.fail("拖动验证码失效，请重新验证！");this.sendSmsSend(this.userinfo).then((function(t){e.userinfo.smsToken=t.smsToken,e.userinfo.dragCaptchaToken="",e.countDown()})).catch((function(t){switch(e.$refs.dragComponent.initDragCaptcha(),t.code){case 4030301:case 4030302:e.dragKey+=1,e.userinfo.dragCaptchaToken="",e.userinfo.smsToken="",a.a.fail(t.message);break;case 4030303:e.dragEnable?a.a.fail(t.message):e.dragEnable=!0;break;default:a.a.fail(t.message)}}))},clickSmsBtn:function(){!this.count.codeBtnDisable&&this.validated.mobile&&(this.$refs.dragComponent.dragToEnd?this.handleSendSms():Object(a.a)("请先完成拼图验证"))}}},f=n("2f62");function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m={name:"FastLogin",components:{EDrag:s.a},mixins:[c.a,u.a,d],data:function(){return{userinfo:{mobile:"",dragCaptchaToken:void 0,smsCode:"",smsToken:"",type:"sms_login"},userTerms:!1,privacyPolicy:!1,registerSettings:null,agreement:!0,dragEnable:!0,dragKey:0,errorMessage:{mobile:""},validated:{mobile:!1}}},computed:{btnDisable:function(){return!(this.userinfo.mobile&&this.userinfo.smsCode&&this.agreement)}},created:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.$store.state.token){t.next=4;break}return a.a.loading({message:"请稍后"}),e.afterLogin(),t.abrupt("return");case 4:e.getPrivacySetting();case 5:case"end":return t.stop()}}),t)})))()},methods:h(h({},Object(f.c)(["addUser","setMobile","sendSmsSend","fastLogin"])),{},{getPrivacySetting:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.a.getSettings({query:{type:"user"}}).then((function(t){t.auth.user_terms_enabled&&(e.userTerms=!0),t.auth.privacy_policy_enabled&&(e.privacyPolicy=!0)})).catch((function(e){a.a.fail(e.message)}));case 2:e.registerSettings=t.sent;case 3:case"end":return t.stop()}}),t)})))()},lookPrivacyPolicy:function(){window.location.href=window.location.origin+"/mapi_v2/School/getPrivacyPolicy"},handleSmsSuccess:function(e){this.userinfo.dragCaptchaToken=e,this.validateMobileOrPsw("mobile"),0===this.errorMessage.mobile.length&&this.handleSendSms()},handleSubmitSuccess:function(){this.afterLogin()},checkAgree:function(){this.agreement=!this.agreement},changeLogin:function(){this.$router.push({name:"login"})}})},b=n("0c7c"),p=Object(b.a)(m,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"login"},[n("span",{staticClass:"login-title"},[e._v("手机快捷登录")]),n("span",{staticClass:"login-des"},[e._v("新用户将为您自动注册")]),n("van-field",{staticClass:"login-input e-input",attrs:{border:!1,"error-message":e.errorMessage.mobile,placeholder:"请输入手机号","max-length":"11",type:"number",clearable:""},on:{blur:function(t){return e.validateMobileOrPsw("mobile")},keyup:function(t){return e.validatedChecker()}},model:{value:e.userinfo.mobile,callback:function(t){e.$set(e.userinfo,"mobile",t)},expression:"userinfo.mobile"}}),e.dragEnable?n("e-drag",{key:e.dragKey,ref:"dragComponent",attrs:{"limit-type":"sms_login"},on:{success:e.handleSmsSuccess}}):e._e(),n("van-field",{ref:"smsCode",staticClass:"login-input e-input",attrs:{border:!1,type:"number",center:"",clearable:"","max-length":"6",placeholder:"请输入验证码"},model:{value:e.userinfo.smsCode,callback:function(t){e.$set(e.userinfo,"smsCode",t)},expression:"userinfo.smsCode"}},[n("van-button",{attrs:{slot:"button",disabled:e.count.codeBtnDisable||!e.validated.mobile,size:"small",type:"primary"},on:{click:e.clickSmsBtn},slot:"button"},[e._v("\n      发送验证码\n      "),n("span",{directives:[{name:"show",rawName:"v-show",value:e.count.showCount,expression:"count.showCount"}]},[e._v("("+e._s(e.count.num)+")")])])],1),n("van-button",{staticClass:"primary-btn mb20",attrs:{disabled:e.btnDisable,type:"default"},on:{click:function(t){return e.handleSubmit(e.handleSubmitSuccess)}}},[e._v("登录")]),n("div",{staticClass:"login-bottom text-center"},[e.userTerms||e.privacyPolicy?n("div",{staticClass:"login-agree"},[n("van-checkbox",{attrs:{"icon-size":16,"checked-color":"#408ffb"},on:{click:e.checkAgree},model:{value:e.agreement,callback:function(t){e.agreement=t},expression:"agreement"}}),e._v("\n      我已阅读并同意"),e.userTerms?n("i",{on:{click:e.lookPrivacyPolicy}},[e._v("《用户服务》")]):e._e(),e.userTerms&&e.privacyPolicy?n("span",[e._v("和")]):e._e(),e.privacyPolicy?n("span",[e._v("《"),n("i",{on:{click:e.lookPrivacyPolicy}},[e._v("隐私协议")]),e._v("》")]):e._e()],1):e._e(),n("div",{staticClass:"login-change",on:{click:e.changeLogin}},[n("img",{staticClass:"login_change-icon",attrs:{src:"static/images/login_change.png"}}),e._v("切换账号密码登录\n    ")])])],1)}),[],!1,null,null,null);t.default=p.exports},7067:function(e,t,n){"use strict";n("e17f");var i=n("2241"),a=(n("e7e5"),n("d399")),r=n("a026"),s=n("3ce7"),o=/micromessenger/.test(navigator.userAgent.toLowerCase());t.a=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||n&&!t)a.a.fail("缺少分享参数");else{var c={domainUri:location.origin,itemUri:"",source:"h5"};s.a.marketingActivities({query:{activityId:e},data:c}).then((function(e){var s=-1!==e.url.indexOf("?")?"&":"?",c=n?"".concat(t).concat(s,"ticket=").concat(e.ticket):e.url;o?window.location.href=c:i.a.confirm({message:"去微信完成活动",confirmButtonText:"复制链接",title:""}).then((function(){try{r.default.prototype.$copyText(c).then((function(){a.a.success("复制成功")}),(function(){a.a.fail("请更换浏览器复制")}))}catch(e){a.a.fail("请更换浏览器复制")}})).catch((function(){}))})).catch((function(e){a.a.fail(e.message)}))}}},a262:function(e,t,n){"use strict";var i=n("7067");t.a={methods:{activityHandle:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(i.a)(e,t,n)}}}},d863:function(e,t,n){"use strict";n("a481");var i=n("7067");t.a={data:function(){return{redirect:""}},created:function(){this.redirect=decodeURIComponent(this.$route.fullPath)},methods:{afterLogin:function(){var e=this,t=this.$route.query.redirect?decodeURIComponent(this.$route.query.redirect):"/",n=this.$route.query.skipUrl?decodeURIComponent(this.$route.query.skipUrl):"",a=this.$route.query.callbackType,r=this.$route.query.activityId,s=decodeURIComponent(this.$route.query.callback);setTimeout((function(){if(a)switch(a){case"marketing":Object(i.a)(r,s)}else n?e.$router.replace({path:t,query:{backUrl:n}}):e.$router.replace({path:t})}),2e3)}}}},f13d:function(e,t,n){"use strict";n("8e6e"),n("ac6a"),n("456d");var i=n("75fc"),a=(n("e7e5"),n("d399")),r=n("bd86"),s=(n("c5f6"),n("3ce7"));function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}var c={props:{tips:{type:String,default:"拖动左边滑块完成上方拼图"},limitType:{type:String,default:""}},data:function(){return{imgInfo:{url:"",jigsaw:"",token:""},dragState:{left:0,width:0,currentX:0,currentLeft:0,btnWidth:0,maskWidth:0},dragToEnd:!1}},created:function(){this.initDragCaptcha()},mounted:function(){var e=this.$refs.bar,t=this.$refs.dragBtn,n=(this.$refs.drag,e.getBoundingClientRect());Object.assign(this.dragState,{left:Number(n.left.toFixed(2)),width:e.clientWidth,btnWidth:t.offsetWidth/2})},methods:{initDragCaptcha:function(){var e=this,t={};this.limitType&&(t={limitType:this.limitType}),s.a.dragCaptcha({data:t}).then((function(t){e.imgInfo=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t),Object.assign(e.dragState,{currentLeft:0,maskWidth:0}),e.dragToEnd=!1})).catch((function(e){a.a.fail(e.message)}))},handletTouchEnd:function(){var e=this;if(!this.dragToEnd&&this.dragState.currentLeft){var t=this.getToken();this.dragToEnd=!0,s.a.dragValidate({query:{token:t}}).then((function(n){a.a.success("验证成功"),e.$emit("success",t)})).catch((function(t){a.a.fail(t.message),e.initDragCaptcha()}))}},handleTouchMove:function(e){if(!this.dragToEnd){e.preventDefault();var t=this.$refs.dragBtn,n=(this.$refs.dragImgBg,this.dragState),i=e.clientX?e.clientX.toFixed(2):e.targetTouches[0].pageX.toFixed(2)-this.$refs.drag.offsetLeft,a=(i-n.left-n.btnWidth).toFixed(2);a<0&&(a=0),i>n.width+this.$refs.drag.offsetLeft&&(a=n.width-this.$refs.dragImg.width),Object.assign(this.dragState,{currentLeft:a,maskWidth:(Number(a)+t.offsetWidth/2).toFixed(2)})}},calPositionX:function(){var e=this.$refs.dragImgBg,t=(e.naturalWidth/e.width).toFixed(2);return(Number(this.dragState.currentLeft).toFixed(2)*t).toFixed(2)},getToken:function(){var e={token:this.imgInfo.token,captcha:this.calPositionX()};return Object(i.a)(btoa(JSON.stringify(e))).reverse().join("")}}},u=n("0c7c"),l=Object(u.a)(c,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"drag",staticClass:"e-drag"},[n("div",{staticClass:"e-drag-section"},[n("div",{staticClass:"e-drag-img"},[n("img",{ref:"dragImgBg",attrs:{src:e.imgInfo.url,alt:""}}),n("img",{ref:"dragImg",staticClass:"e-drag-img__dragable",style:{left:e.dragState.currentLeft+"px"},attrs:{src:e.imgInfo.jigsaw,alt:""}})]),n("div",{ref:"bar",staticClass:"e-drag-bar"},[n("span",[e._v(e._s(e.tips))]),n("div",{staticClass:"e-drag-bar__mask",style:{width:e.dragState.maskWidth+"px"}}),n("div",{ref:"dragBtn",staticClass:"e-drag-btn",style:{left:e.dragState.currentLeft+"px"},on:{touchend:e.handletTouchEnd,touchmove:e.handleTouchMove}},[n("img",{attrs:{src:"static/images/drag.png",alt:""}})])])])])}),[],!1,null,null,null);t.a=l.exports}}]);