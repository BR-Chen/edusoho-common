(window.webpackJsonp=window.webpackJsonp||[]).push([["testpaperResult"],{a730:function(t,e,s){"use strict";s.r(e),s("e17f");var a=s("2241"),i=(s("e7e5"),s("d399")),r=(s("a481"),s("c5f6"),s("ac6a"),s("96cf"),s("3b8d")),n=s("db72"),u=s("3ce7"),c=s("2f62"),l=s("faa5"),o=s("b7cf"),d=s("0d25"),m={name:"TestpaperResult",mixins:[o.a],data:function(){return{enable_facein:"",isReadOver:!1,resultId:null,again:0,result:{},calHeight:null,subjectList:{},question_type_seq:[],targetId:null,doTimes:null,redoInterval:null,remainTime:null,timeMeter:null,testpaperTitle:null,obj:{single_choice:"单选题",choice:"多选题",essay:"问答题",uncertain_choice:"不定项选择题",determine:"判断题",fill:"填空题",material:"材料题"},color:{right:"green",none:"brown",wrong:"orange",partRight:"orange",noAnswer:"gray"}}},computed:Object(n.a)({},Object(c.d)({isLoading:function(t){return t.isLoading},user:function(t){return t.user}}),{usedTime:function(){var t=parseInt(this.result.usedTime)||0;return t<=60?1:Math.round(t/60)}}),watch:{doTimes:function(){this.calSubjectHeight()}},created:function(){this.getTestpaperResult()},beforeRouteEnter:function(t,e,s){document.getElementById("app").style.background="#f6f6f6",s()},beforeRouteLeave:function(t,e,s){document.getElementById("app").style.background="",s()},beforeDestroy:function(){this.clearTime()},methods:Object(n.a)({},Object(c.c)({setNavbarTitle:l.k}),{},Object(c.b)("course",["handExamdo"]),{getTestpaperResult:function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.testpaperResult({query:{resultId:this.$route.query.resultId}}).then((function(t){e.result=t.testpaperResult,e.question_type_seq=t.testpaper.metas.question_type_seq,e.isReadOver="finished"===e.result.status,e.getSubjectList(t.items),e.calSubjectHeight(),e.canDoing(e.result,e.user.id).then((function(){e.startTestpaper("KeepDoing")})).catch((function(t){var s=t.answer,a=t.endTime;e.submitExam(s,a)}))}));case 2:this.getInfo();case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),judgeTime:function(){var t=this,e=this.redoInterval,s=0;if(0!=e){var a=60*parseInt(e)*1e3,i=(new Date).getTime(),r=1e3*parseInt(this.result.checkedTime)+a;this.again=i>=r,this.again||(this.timeMeter=setInterval((function(){s=s++,t.remainTime=Object(d.getdateTimeDown)(r,s),""==t.remainTime&&(t.again=!0,t.clearTime())}),1e3))}else this.again=!0},getSubjectList:function(t){var e=this,s=function(s){var a=[];t[s].forEach((function(t){"material"===s?t.subs.forEach((function(t){e.getStatus(t,a)})):e.getStatus(t,a)})),e.subjectList[s]=a};for(var a in t)s(a)},calSubjectHeight:function(){var t=this;this.$nextTick((function(){var e=t.$refs.data.offsetHeight+t.$refs.tag.offsetHeight+46,s=document.documentElement.clientHeight-e-(t.$refs.footer.offsetHeight||0);t.calHeight="".concat(s,"px")}))},getStatus:function(t,e){var s={};s.seq=t.seq,t.testResult?s.status=t.testResult.status:s.status="noAnswer",e.push(s)},submitExam:function(t,e){var s=this;e=e||(new Date).getTime();var a={answer:t,resultId:this.result.id,userId:this.user.id,beginTime:Number(this.result.beginTime),endTime:e};this.handExamdo(a).then((function(t){s.$router.replace({name:"testpaperResult",query:{resultId:s.$route.query.resultId,testId:s.$route.query.testId,targetId:s.$route.query.targetId}})})).catch((function(t){i.a.fail(t.message)}))},clearTime:function(){clearInterval(this.timeMeter),this.timeMeter=null},startTestpaper:function(){1===this.enable_facein?a.a.alert({title:"",confirmButtonText:"知道了",message:"本场考试已开启云监考，暂不支持在移动端答题，请前往PC端进行答题。"}).then((function(){})):this.goDoTestpaper()},goDoTestpaper:function(){this.$router.replace({name:"testpaperDo",query:{testId:this.result.testId,targetId:this.targetId,title:this.testpaperTitle,action:"redo"},params:{KeepDoing:!0}})},getInfo:function(){var t=this;this.testId=this.$route.query.testId,this.targetId=this.$route.query.targetId,u.a.testpaperIntro({params:{targetId:this.targetId,targetType:"task"},query:{testId:this.testId}}).then((function(e){t.testpaperTitle=e.task.title,t.setNavbarTitle(e.task.title),t.doTimes=Number(e.task.activity.testpaperInfo.doTimes),t.redoInterval=Number(e.task.activity.testpaperInfo.redoInterval),t.enable_facein=e.task.enable_facein,t.judgeTime()}))},viewAnalysis:function(){this.$router.push({name:"testpaperAnalysis",query:{resultId:this.$route.query.resultId,title:this.testpaperTitle}})}})},f=s("a6c2"),h=Object(f.a)(m,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"testResults"},[t.isLoading?s("e-loading"):t._e(),t.result?s("div",{ref:"data",staticClass:"result-data"},[s("div",{staticClass:"result-data__item"},[t._v("\n      本次得分\n      "),t.isReadOver?s("div",{staticClass:"result-data__bottom data-number-orange data-medium"},[s("span",{staticClass:"data-number"},[t._v(t._s(t.result.score))]),t._v("分\n      ")]):s("div",{staticClass:"result-data__bottom data-text-blue"},[t._v("待批阅")])]),s("div",{staticClass:"result-data__item"},[t._v("\n      正确率\n      "),t.isReadOver?s("div",{staticClass:"result-data__bottom data-number-green data-medium"},[s("span",{staticClass:"data-number"},[t._v(t._s(t.result.rightRate))]),t._v("%\n      ")]):s("div",{staticClass:"result-data__bottom data-text-blue"},[t._v("待批阅")])]),s("div",{staticClass:"result-data__item"},[t._v("\n      做题用时\n      "),s("div",{staticClass:"result-data__bottom data-number-gray data-medium"},[s("span",{staticClass:"data-number"},[t._v(t._s(t.usedTime))]),t._v("分钟\n      ")])])]):t._e(),s("div",{ref:"tag",staticClass:"result-tag"},[t._m(0),t._m(1),t._m(2),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.isReadOver,expression:"!isReadOver"}],staticClass:"result-tag-item clearfix"},[s("div",{staticClass:"result-tag-item__circle circle-brown"}),t._v("待批阅\n    ")])]),s("div",{staticClass:"result-subject",style:{height:t.calHeight}},[t._l(t.question_type_seq,(function(e,a){return s("van-panel",{key:a,staticClass:"result-panel",attrs:{title:t.obj[e]}},[s("ul",{staticClass:"result-list"},t._l(t.subjectList[e],(function(e,a){return s("li",{key:a,class:["result-list__item testpaper-number","circle-"+t.color[e.status]]},[t._v(t._s(e.seq))])})),0)])})),s("div",{ref:"footer",staticClass:"result-footer"},[s("van-button",{staticClass:"result-footer__btn",style:{marginRight:t.isReadOver&&!t.doTimes?"2vw":0},attrs:{type:"primary"},on:{click:function(e){return t.viewAnalysis()}}},[t._v("查看解析")]),t.again&&t.isReadOver&&0==t.doTimes?s("van-button",{staticClass:"result-footer__btn",attrs:{type:"primary"},on:{click:function(e){return t.startTestpaper()}}},[t._v("再考一次")]):t._e(),!t.again&&t.remainTime&&t.isReadOver&&0==t.doTimes?s("van-button",{staticClass:"result-footer__btn",staticStyle:{"line-height":"21px"},attrs:{type:"primary",disabled:""}},[t._v("在"+t._s(t.remainTime)+"后可以再考一次")]):t._e()],1)],2)],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"result-tag-item clearfix"},[e("div",{staticClass:"result-tag-item__circle circle-green"}),this._v("正确\n    ")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"result-tag-item clearfix"},[e("div",{staticClass:"result-tag-item__circle circle-orange"}),this._v("错误\n    ")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"result-tag-item clearfix"},[e("div",{staticClass:"result-tag-item__circle circle-gray"}),this._v("未作答\n    ")])}],!1,null,null,null);e.default=h.exports},b7cf:function(t,e,s){"use strict";s("c5f6"),s("e17f");var a=s("2241");s("456d"),s("ac6a"),e.a={methods:{canDoing:function(t,e){return new Promise((function(s,i){if(t&&"doing"===t.status){var r="".concat(e,"-").concat(t.id),n=JSON.parse(localStorage.getItem(r));n=n?Object.keys(n).forEach((function(t){n[t]=n[t].filter((function(t){return""!==t}))})):{},a.a.confirm({title:"提示",cancelButtonText:"放弃考试",confirmButtonText:"继续考试",message:"您有未完成的考试，是否继续？"}).then((function(){if(Number(t.limitedTime)>0){var e=Math.ceil(((new Date).getTime()-1e3*t.beginTime)/1e3/60);if(Number(e)>Number(t.limitedTime)){var a=Number(1e3*t.beginTime)+Number(60*t.limitedTime*1e3);return void i({answer:n,endTime:a})}}s()})).catch((function(){i({answer:n,endTime:null})}))}}))}}}}}]);