(window.webpackJsonp=window.webpackJsonp||[]).push([["live"],{1185:function(e,t,s){"use strict";var i={name:"e-live-card",props:{course:{type:Object,default:function(){}}},computed:{status:function(){if("live"===this.course.type){var e=(new Date).getTime(),t=new Date(this.course.startTime),s=new Date(this.course.endTime);return e<=t?"nostart":e>s?"ungenerated"===this.course.activity.replayStatus?"end":"replay":"default"}}},filters:{liveStatusText:function(e){switch(e){case"replay":return"观看回放";case"default":return"正在直播";case"nostart":return"即将开始";case"end":return"已结束";default:return""}},liveBtnText:function(e){switch(e){case"replay":return"观看回放";case"default":return"进入教室";case"nostart":return"即将开始";case"end":return"暂无回放";default:return""}}},methods:{getStatusClass:function(e){switch(e){case"replay":return"live-status--end";case"default":return"live-status--start";case"nostart":return"live-status--default";case"end":default:return""}},getBtnClass:function(e){switch(e){case"replay":return"live-btn--default";case"default":return"live-btn--start";case"nostart":return"live-btn--default";case"end":return"live-btn--end";default:return""}},toClassroom:function(){this.$emit("toClassroom",this.course.classroom.id)},toTask:function(){if("end"!==this.status){var e={id:this.course.id,type:this.course.type,courseId:this.course.course.id};this.$emit("toTask",e)}},toCourse:function(){this.$emit("toCourse",this.course.course.id)}}},a=s("a6c2"),n=Object(a.a)(i,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"e-course-card"},[s("div",{staticClass:"live-list__item"},[s("div",{staticClass:"live-item__top",on:{click:function(t){return e.toCourse()}}},[s("span",[e._v(e._s(e.course.course.displayedTitle))]),s("i",{staticClass:"iconfont icon-arrow-right"})]),s("div",{staticClass:"live-item__content"},[s("div",{staticClass:"live-content__left"},[s("div",{staticClass:"live-content__title"},[s("i",{staticClass:"iconfont icon-zhibo"}),e._v("\n          "+e._s(e.course.activity.title)+"\n        ")]),s("div",{staticClass:"live-content__dec"},[s("span",{staticClass:"live-content__time"},[e._v(e._s(e._f("formateLiveTime")(e.course.startTime)))]),s("span",{class:e.getStatusClass(e.status)},[e._v("\n            "+e._s(e._f("liveStatusText")(e.status))+"\n            "),s("i",{directives:[{name:"show",rawName:"v-show",value:"default"===e.status,expression:" status==='default' "}],staticClass:"iconfont icon-zhibo1"})])])]),s("div",{staticClass:"live-content__right"},[s("div",{class:["live-btn",e.getBtnClass(e.status)],on:{click:function(t){return e.toTask()}}},[e._v(e._s(e._f("liveBtnText")(e.status)))])])]),e.course.classroom?s("div",{staticClass:"live-item__bottom van-hairline--top",on:{click:function(t){return e.toClassroom()}}},[s("span",[e._v(e._s(e.course.classroom.title))]),s("i",{staticClass:"iconfont icon-arrow-right"})]):e._e()])])}),[],!1,null,null,null);t.a=n.exports},"2d42":function(e,t,s){"use strict";var i={name:"e-empty",props:{text:{type:String,default:""}}},a=s("a6c2"),n=Object(a.a)(i,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"e-empty"},[t("img",{staticClass:"e-empty__img",attrs:{src:"static/images/empty.png"}}),t("p",{staticClass:"e-empty__text"},[this._v(this._s(this.text))])])}),[],!1,null,null,null);t.a=n.exports},7067:function(e,t,s){"use strict";s("e17f");var i=s("2241"),a=(s("e7e5"),s("d399")),n=s("a026"),o=s("3ce7"),r=s("4eb5"),c=s.n(r);n.a.use(c.a);var u=/micromessenger/.test(navigator.userAgent.toLowerCase());t.a=function(e,t){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||s&&!t)a.a.fail("缺少分享参数");else{var r={domainUri:location.origin,itemUri:"",source:"h5"};o.a.marketingActivities({query:{activityId:e},data:r}).then((function(e){var o=-1!==e.url.indexOf("?")?"&":"?",r=s?"".concat(t).concat(o,"ticket=").concat(e.ticket):e.url;u?window.location.href=r:i.a.confirm({message:"去微信完成活动",confirmButtonText:"复制链接",title:""}).then((function(){try{n.a.prototype.$copyText(r).then((function(){a.a.success("复制成功")}),(function(){a.a.fail("请更换浏览器复制")}))}catch(e){a.a.fail("请更换浏览器复制")}})).catch((function(){}))})).catch((function(e){a.a.fail(e.message)}))}}},"818d":function(e,t,s){},"89ae":function(e,t,s){"use strict";s.r(t),s("ac6a");var i=s("1185"),a=s("be6e"),n=s.n(a),o=s("2d42"),r=s("0d25"),c=(s("faa5"),s("3ce7")),u=(s("b383"),{name:"live-timetable",components:{Calendar:n.a,ECard:i.a,empty:o.a},data:function(){return{arr2:[],liveTime:[],liveHeight:null,today:"",liveCourse:[],isRequestComplete:!1,isScheduleTime:!1,isLiveCourse:!1,token:"",pullLoading:!1}},created:function(){this.setTitle(),this.getUserInfo()},computed:{noData:function(){return this.isRequestComplete&&!this.liveCourse.length}},mounted:function(){var e=this;this.$nextTick((function(){e.liveHeight=document.body.clientHeight-e.$refs.liveList.offsetTop,e.showToday()}))},methods:{setTitle:function(){window.postNativeMessage({action:"kuozhi_native_header",data:{title:"直播课表"}})},getliveSchedule:function(e){var t=this,s=this.getMonthTime(e);c.a.liveSchedule({params:s,headers:{"Content-Type":"application/x-www-form-urlencoded","X-Auth-Token":this.token}}).then((function(e){t.isScheduleTime=!0,t.setScheduleTime(e)})).catch((function(e){t.sendError(e)}))},setScheduleTime:function(e){var t="",s=[],i=new Date;e.forEach((function(e){var a=new Date(1e3*e.date);t=Object(r.compareDate)(a,i)?"mark1":"mark2",s.push({date:a.toLocaleDateString(),className:t})})),this.liveTime=s},getmyLiveCourse:function(e){var t=this,s=this.getDayTime(e);this.isRequestComplete=!1,c.a.myliveCourse({params:s,headers:{"Content-Type":"application/x-www-form-urlencoded","X-Auth-Token":this.token}}).then((function(e){t.isLiveCourse=!0,t.liveCourse=e,t.isRequestComplete=!0,t.pullLoading=!1})).catch((function(e){t.sendError(e)}))},clickDay:function(e){this.today=Object(r.formatFullTime)(new Date(e)),this.isLiveCourse&&this.getmyLiveCourse(new Date(e))},clickToday:function(e){},changeDate:function(e){this.isScheduleTime&&this.getliveSchedule(e)},showToday:function(){this.today=Object(r.formatFullTime)(new Date),this.$refs.Calendar.ChoseMonth(this.today)},getDayTime:function(e){var t=new Date(e);return{startTime:parseInt(t.setHours(0,0,0,0)/1e3),endTime:parseInt(t.setHours(23,59,59,999)/1e3)}},getMonthTime:function(e){var t=new Date(e);t.setDate(1),t.setHours(0),t.setSeconds(0),t.setMinutes(0);var s=new Date(e);return 11==t.getMonth()?s.setMonth(0):s.setMonth(t.getMonth()+1),s.setDate(1),s.setHours(0),s.setSeconds(0),s.setMinutes(0),{startTime:parseInt(t.getTime()/1e3),endTime:parseInt(s.getTime()/1e3)-1}},getUserInfo:function(){var e=this;window.nativeCallback=function(t){e.token=t.token,e.getliveSchedule(new Date),e.getmyLiveCourse(new Date)},window.postNativeMessage({action:"kuozhi_login_user",data:{force:1}})},toClassroom:function(e){window.postNativeMessage({action:"kuozhi_classroom",data:{classroomId:e}})},toTask:function(e){window.postNativeMessage({action:"kuozhi_learn_task",data:{taskId:e.id,taskType:e.type,courseId:e.courseId}})},toCourse:function(e){window.postNativeMessage({action:"kuozhi_course",data:{courseId:e}})},sendError:function(e){window.postNativeMessage({action:"kuozhi_h5_error",data:{code:e.code,message:e.message}})},initData:function(){this.liveCourse=[],this.isRequestComplete=!1},onRefresh:function(){this.initData(),this.getmyLiveCourse(new Date(this.today))}}}),l=(s("dac4"),s("a6c2")),d=Object(l.a)(u,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("van-pull-refresh",{on:{refresh:e.onRefresh},model:{value:e.pullLoading,callback:function(t){e.pullLoading=t},expression:"pullLoading"}},[s("div",{staticClass:"live-timetable app"},[s("Calendar",{ref:"Calendar",attrs:{markDateMore:e.liveTime,markDate:e.arr2},on:{isToday:e.clickToday,choseDay:e.clickDay,changeMonth:e.changeDate}}),s("div",{staticClass:"bg-gary"}),s("div",{ref:"liveList",staticClass:"live-list",style:{height:e.liveHeight+"px"}},[s("div",{staticClass:"live-list__title"},[s("div",{staticClass:"live-title__left"},[e._v("直播课表")]),s("div",{staticClass:"live-title__right"},[e._v(e._s(e.today))])]),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isRequestComplete,expression:"!isRequestComplete"}],staticClass:"live-timetable-loading"},[s("van-loading",{attrs:{vertical:""}},[e._v("加载中...")])],1),e._l(e.liveCourse,(function(t,i){return e.isRequestComplete?s("e-card",{key:i,attrs:{course:t},on:{toClassroom:e.toClassroom,toTask:e.toTask,toCourse:e.toCourse}}):e._e()})),e.noData?s("empty",{staticClass:"empty__live",attrs:{text:"空空如也，暂无内容"}}):e._e()],2)],1)])}),[],!1,null,"08c7c45c",null);t.default=d.exports},"98c6":function(e,t,s){"use strict";s.r(t);var i=s("1185"),a=s("2d42"),n=s("0d25"),o=s("faa5"),r=s("3ce7"),c={name:"more-live",components:{ECard:i.a,empty:a.a},data:function(){return{today:"",liveCourse:[],isRequestComplete:!1,token:"",isLoad:!0,pullLoading:!1}},computed:{noData:function(){return this.isRequestComplete&&!this.liveCourse.length}},created:function(){this.setTitle(),this.getUserInfo(),this.today=Object(n.formatFullTime)(new Date)},beforeRouteLeave:function(){this.$store.commit(o.t)},methods:{setTitle:function(){window.postNativeMessage({action:"kuozhi_native_header",data:{title:"今日直播"}})},getmyLiveCourse:function(e){var t=this,s=this.getDayTime(e);r.a.myliveCourse({params:s,headers:{"Content-Type":"application/x-www-form-urlencoded","X-Auth-Token":this.token}}).then((function(e){t.liveCourse=e,t.isRequestComplete=!0,t.isLoad=!1,t.pullLoading=!1})).catch((function(e){t.sendError(e)}))},getDayTime:function(e){var t=new Date(e);return{startTime:parseInt(t.setHours(0,0,0,0)/1e3),endTime:parseInt(t.setHours(23,59,59,999)/1e3)}},getUserInfo:function(){var e=this;window.nativeCallback=function(t){e.token=t.token,e.getmyLiveCourse(new Date)},window.postNativeMessage({action:"kuozhi_login_user",data:{force:1}})},toClassroom:function(e){window.postNativeMessage({action:"kuozhi_classroom",data:{classroomId:e}})},toTask:function(e){e.id,e.type,e.courseId,window.postNativeMessage({action:"kuozhi_learn_task",data:{taskId:e.id,taskType:e.type,courseId:e.courseId}})},toCourse:function(e){window.postNativeMessage({action:"kuozhi_course",data:{courseId:e}})},sendError:function(e){window.postNativeMessage({action:"kuozhi_h5_error",data:{code:e.code,message:e.message}})},initData:function(){this.liveCourse=[],this.isRequestComplete=!1},onRefresh:function(){this.initData(),this.getmyLiveCourse(new Date)}}},u=s("a6c2"),l=Object(u.a)(c,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("van-pull-refresh",{on:{refresh:e.onRefresh},model:{value:e.pullLoading,callback:function(t){e.pullLoading=t},expression:"pullLoading"}},[s("div",{staticClass:"app live-timetable"},[s("div",{ref:"liveList",staticClass:"live-list"},[s("div",{staticClass:"live-list__title"},[s("div",{staticClass:"live-title__left"},[e._v("直播课表")]),s("div",{staticClass:"live-title__right"},[e._v(e._s(e.today))])]),s("div",{staticClass:"text-center mt20"},[s("van-loading",{directives:[{name:"show",rawName:"v-show",value:e.isLoad,expression:"isLoad"}],attrs:{size:"24px"}},[e._v("加载中...")])],1),e._l(e.liveCourse,(function(t,i){return e.isRequestComplete?s("e-card",{key:i,attrs:{course:t},on:{toClassroom:e.toClassroom,toTask:e.toTask,toCourse:e.toCourse}}):e._e()})),e.noData?s("empty",{staticClass:"empty__more-live",attrs:{text:"空空如也，暂无内容"}}):e._e()],2)])])}),[],!1,null,null,null);t.default=l.exports},a56c:function(e,t,s){"use strict";s.r(t),s("e7e5");var i=s("d399"),a=(s("96cf"),s("3b8d")),n=s("db72"),o=s("3ce7"),r=s("2f62"),c=s("faa5"),u={mixins:[s("d863").a],data:function(){return{playUrl:"",requestCount:0}},computed:Object(n.a)({},Object(r.d)("course",{joinStatus:function(e){return e.joinStatus}}),{},Object(r.d)({isLoading:function(e){return e.isLoading}})),mounted:function(){var e=Object(a.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.$store.state.token){e.next=3;break}return this.$router.push({name:"login",query:{redirect:this.redirect}}),e.abrupt("return");case 3:this.handleLive();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),methods:Object(n.a)({},Object(r.c)({setNavbarTitle:c.k}),{handleLive:function(){var e=this.$route.query,t=e.taskId,s=e.replay,i=e.title;this.setNavbarTitle(i),"true"!=String(s)?this.requestLiveNo(t):this.getReplayUrl(t)},getReplayUrl:function(e){var t=this;o.a.getLiveReplayUrl({query:{taskId:e}}).then((function(e){if(e.nonsupport)Object(i.a)("回放暂不支持");else if(e.url)if(e.url.indexOf("/error/")>-1)Object(i.a)("暂无回放");else{var s=e.url.indexOf("/");t.playUrl=0==s?e.url:e.url.substring(s)}else e.error&&i.a.fail(e.error.message)})).catch((function(e){i.a.fail(e.message)}))},requestLiveNo:function(e){var t=this;o.a.requestLiveNo({query:{taskId:e}}).then((function(s){s.no&&t.getLiveUrl(e,s.no),s.error&&i.a.fail(s.error.message)})).catch((function(e){i.a.fail(e.message)}))},getLiveUrl:function(e,t){var s=this;this.requestCount++,o.a.getLiveUrl({query:{taskId:e,no:t}}).then((function(a){if(a.roomUrl){var n=a.roomUrl.indexOf("/");s.playUrl=0==n?a.roomUrl:a.roomUrl.substring(n)}else s.requestCount<30?s.getLiveUrl(e,t):Object(i.a)("获取直播失败");a.error&&i.a.fail(a.error.message)})).catch((function(e){i.a.fail(e.message)}))}})},l=s("a6c2"),d=Object(l.a)(u,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"web-view"},[this.isLoading?t("e-loading"):this._e(),t("iframe",{attrs:{id:"player",src:this.playUrl,width:"100%",frameborder:"0"}})],1)}),[],!1,null,null,null);t.default=d.exports},d863:function(e,t,s){"use strict";s("a481");var i=s("7067");t.a={data:function(){return{redirect:""}},created:function(){this.redirect=decodeURIComponent(this.$route.fullPath)},methods:{afterLogin:function(){var e=this,t=this.$route.query.redirect?decodeURIComponent(this.$route.query.redirect):"/",s=this.$route.query.skipUrl?decodeURIComponent(this.$route.query.skipUrl):"",a=this.$route.query.callbackType,n=this.$route.query.activityId,o=decodeURIComponent(this.$route.query.callback);setTimeout((function(){if(a)switch(a){case"marketing":Object(i.a)(n,o)}else s?e.$router.replace({path:t,query:{backUrl:s}}):e.$router.replace({path:t})}),2e3)}}}},dac4:function(e,t,s){"use strict";var i=s("818d");s.n(i).a}}]);